# 프로젝트 분석: 웹소켓 기반 채팅 애플리케이션 '슛(Shoot)'

이 프로젝트는 Spring Boot(Kotlin)을 백엔드로, React(TypeScript)를 프론트엔드로 사용하는 실시간 채팅 애플리케이션입니다. 웹소켓과 SSE(Server-Sent Events)를 활용해 실시간 통신을 구현했고, MongoDB를 데이터베이스로, Redis를 캐싱 및 메시지 브로커로 사용하고 있습니다.

## 시스템 아키텍처

## 핵심 기술 스택

### 백엔드
- **Spring Boot 3.4.3 (Kotlin 1.9.25)** - 애플리케이션 서버
- **Spring WebSocket** - 실시간 양방향 통신
- **Spring Security** - 인증 및 권한 관리
- **MongoDB** - 주 데이터베이스 (사용자, 채팅방, 메시지 저장)
- **Redis** - 캐싱, 메시지 브로커, 실시간 상태 관리
- **Kafka** - 메시지 큐잉 및 처리
- **JWT** - 토큰 기반 인증

### 프론트엔드
- **React 18** - UI 라이브러리
- **TypeScript** - 타입 안전성 확보
- **SockJS/STOMP** - 웹소켓 클라이언트
- **Axios** - HTTP 요청 처리
- **Styled-components** - 스타일링
- **Event Source Polyfill** - SSE 연결

## 백엔드 아키텍처 (헥사고날)

프로젝트는 헥사고날 아키텍처를 채택하고 있으며, 도메인 중심의 개발 방식을 따르고 있습니다. 다음은 주요 패키지 구조입니다:

- **domain**: 핵심 비즈니스 모델과 로직
- **application.port**: 애플리케이션의 인터페이스 (in/out)
- **application.service**: 비즈니스 로직 구현
- **adapter.in**: 외부에서 들어오는 요청 처리 (컨트롤러, 이벤트 리스너 등)
- **adapter.out**: 외부 시스템 연동 (데이터베이스, 메시지 브로커 등)
- **infrastructure**: 공통 설정 및 기능

## 주요 기능 및 흐름

### 1. 인증 및 사용자 관리



JWT 기반 인증 시스템이 구현되어 있으며:
- 로그인 시 access token과 refresh token 발급
- 토큰 만료 시 refresh token으로 새 access token 발급
- Spring Security와 JwtAuthFilter를 통한 API 접근 제어
- SSE와 WebSocket 연결에서도 JWT 인증 적용

### 2. 실시간 채팅





실시간 채팅 시스템은 다중 서버 환경에서도 작동하는 확장 가능한 아키텍처를 갖추고 있습니다:

1. **메시지 전송 경로**:
    - WebSocket(STOMP) → Redis PubSub → 다른 클라이언트 (실시간 전달)
    - WebSocket → Kafka → 메시지 처리기 → MongoDB (영구 저장)

2. **메시지 상태 추적**:
    - 임시 ID 기반 메시지 상태 관리 (sending → sent_to_kafka → saved)
    - 메시지 ID를 통한 읽음 상태 추적

3. **사용자 활동 추적**:
    - 채팅방 활성 상태 관리 (active:userId:roomId)
    - 타이핑 인디케이터를 통한 활동 표시

### 3. 친구 및 소셜 기능






다양한 소셜 기능이 구현되어 있습니다:

1. **친구 관리**:
    - 친구 요청 보내기/수락/거절
    - 코드 기반 친구 찾기
    - BFS 알고리즘을 활용한 친구 추천

2. **채팅방 관리**:
    - 1:1 채팅
    - 그룹 채팅
    - 채팅방 즐겨찾기(고정) 기능

3. **읽음 상태 관리**:
    - 개별 메시지 읽음 처리
    - 전체 메시지 읽음 처리

## 장점

1. **확장성 높은 아키텍처**
    - 헥사고날 아키텍처를 통한 관심사 분리 및 테스트 용이성
    - Kafka + Redis 조합으로 높은 트래픽 처리 가능
    - 독립적인 서비스로 분리 가능한 구조

2. **실시간성 및 신뢰성**
    - WebSocket + Redis PubSub으로 즉각적인 메시지 전달
    - Kafka를 통한 안정적인 메시지 영구 저장
    - 다양한 이벤트 기반 상태 업데이트

3. **사용자 경험**
    - 타이핑 인디케이터, 읽음 상태 등 상세한 상태 표시
    - 임시 메시지 ID를 통한 메시지 상태 추적
    - 모바일 친화적인 UI 디자인

## 허점 및 개선 가능 영역

1. **에러 처리 및 복구**
    - 일부 에러 처리 로직이 일관되지 않음
    - 네트워크 불안정 환경에서의 재시도 전략 보완 필요
    - 더 상세한 에러 메시지와 가이드 필요

2. **성능 및 최적화**
    - MongoDB 쿼리 최적화 (인덱스 활용, 필요한 필드만 조회)
    - 무한 스크롤 시 페이징 성능 개선
    - 대량 메시지 조회 시 지연 로딩 구현

3. **보안**
    - JWT 토큰 관련 보안 강화 (시크릿 키 관리, 토큰 무효화)
    - WebSocket 메시지 검증 및 제한 강화
    - 사용자 입력 검증 (XSS, 인젝션 방지)

4. **코드 일관성**
    - 타입스크립트 인터페이스 중복 정의 문제
    - 일부 비동기 처리 패턴 불일치
    - 상태 관리 패턴 통일 필요

## 실사용 시나리오

### 사용자 등록 및 로그인
1. 사용자는 회원가입 화면에서 사용자명과 닉네임으로 계정 생성
2. 로그인하면 JWT 토큰 발급 (access + refresh)
3. 토큰은 localStorage에 저장되며 API 요청에 자동 포함
4. 토큰 만료 시 refresh 토큰으로 자동 갱신

### 친구 추가
1. '친구' 탭에서 친구 검색 또는 코드로 친구 찾기
2. 친구 요청을 보내면 대상 사용자의 '소셜' 탭에 알림
3. 상대방이 수락하면 양쪽 모두 '친구' 탭에 표시
4. SSE 이벤트로 친구 목록 실시간 갱신

### 채팅 시작 및 메시지 전송
1. 친구 목록에서 친구 클릭 시 1:1 채팅방 생성/조회
2. WebSocket 연결 및 이전 메시지 로드
3. 메시지 입력 시:
    - 임시 ID 생성 및 클라이언트에 즉시 표시
    - Redis를 통해 실시간 브로드캐스트
    - Kafka를 통해 영구 저장
    - 저장 완료 후 상태 업데이트
4. 다른 사용자가 메시지를 읽으면 읽음 상태 실시간 업데이트

### 채팅방 목록 관리
1. '채팅' 탭에서 참여 중인 채팅방 목록 확인
2. 채팅방 즐겨찾기 기능으로 중요 대화 상단 고정
3. 읽지 않은 메시지 수 실시간 업데이트 (SSE)
4. 마지막 메시지 미리보기 표시