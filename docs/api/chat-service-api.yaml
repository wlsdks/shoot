openapi: 3.0.3

info:
  title: Shoot Chat Service API
  version: 1.0.0
  description: |
    Shoot 애플리케이션의 Chat Service REST API 명세서

    **주요 기능**:
    - 채팅방 생성 및 관리 (1:1, 그룹)
    - 메시지 전송 및 관리
    - 메시지 리액션 및 고정
    - 채팅방 검색 및 즐겨찾기
    - 예약 메시지 및 전달

    **비즈니스 규칙**:
    - 1:1 채팅: 정확히 2명
    - 그룹 채팅: 2~100명
    - 메시지 최대 길이: 4,000자
    - 첨부파일 최대 크기: 50MB
    - 채팅방당 최대 고정 메시지: 5개
    - 메시지 수정 시간 제한: 24시간

    **MSA 전환 대비**: 이 API는 향후 독립된 Chat Service로 분리될 예정입니다.
  contact:
    name: Shoot Development Team
    email: dev@shoot.com

servers:
  - url: http://localhost:8080
    description: Local development server
  - url: https://api.shoot.com
    description: Production server

tags:
  - name: Chat Room
    description: 채팅방 관리 API (생성, 조회, 수정, 퇴장)
  - name: Chat Room Search
    description: 채팅방 검색 API
  - name: Chat Room Favorite
    description: 채팅방 즐겨찾기 API
  - name: Chat Room Notice
    description: 채팅방 공지사항 API
  - name: Chat Room List
    description: 채팅방 목록 관리 API
  - name: Multiple Chat Room
    description: 다중 채팅방 작업 API
  - name: Message
    description: 메시지 관리 API
  - name: Message Reaction
    description: 메시지 리액션 API
  - name: Message Pin
    description: 메시지 고정 API
  - name: Scheduled Message
    description: 예약 메시지 API
  - name: Message Forward
    description: 메시지 전달 API
  - name: Message Read
    description: 메시지 읽음 처리 API

security:
  - BearerAuth: []

paths:
  /api/v1/chatrooms/create/direct:
    post:
      tags:
        - Chat Room
      summary: 1:1 채팅방 생성
      description: |
        특정 사용자와 친구의 1:1 채팅방을 생성합니다.

        **비즈니스 규칙**:
        - 정확히 2명 (본인 + 친구)
        - 이미 1:1 채팅방이 있으면 기존 채팅방 반환
        - 친구 관계여야 생성 가능
        - 자기 자신과 채팅 생성 불가

        **워크플로우**:
        1. 친구 관계 확인
        2. 기존 1:1 채팅방 조회
        3. 없으면 새 ChatRoom 엔티티 생성 (type: INDIVIDUAL)
        4. CHAT_ROOM_CREATED 이벤트 발행
        5. 채팅방 정보 반환

        **이벤트**:
        - `CHAT_ROOM_CREATED`: 채팅방 생성 시 발행
      operationId: createDirectChat
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateDirectChatRequest'
            examples:
              normal:
                summary: 일반적인 1:1 채팅 생성
                value:
                  userId: 1
                  friendId: 2
      responses:
        '200':
          description: 채팅방 생성 성공 (또는 기존 채팅방 반환)
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ResponseDto'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ChatRoomResponse'
              examples:
                newChatRoom:
                  summary: 새 채팅방 생성
                  value:
                    success: true
                    data:
                      roomId: 101
                      title: "Jane Smith"
                      lastMessage: null
                      unreadMessages: 0
                      isPinned: false
                      timestamp: "오후 3:15"
                    message: "채팅방이 생성되었습니다."
                    errorCode: null
                    timestamp: "2025-01-08T15:15:00"
                    code: 200
                existingChatRoom:
                  summary: 기존 채팅방 반환
                  value:
                    success: true
                    data:
                      roomId: 50
                      title: "Jane Smith"
                      lastMessage: "안녕하세요!"
                      unreadMessages: 2
                      isPinned: true
                      timestamp: "오전 11:20"
                    message: "채팅방이 생성되었습니다."
                    errorCode: null
                    timestamp: "2025-01-08T15:15:00"
                    code: 200
        '400':
          description: 잘못된 요청
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                selfChat:
                  summary: 자기 자신과 채팅
                  value:
                    success: false
                    data: null
                    message: "자기 자신과 채팅을 생성할 수 없습니다."
                    errorCode: "SELF_CHAT_NOT_ALLOWED"
                    timestamp: "2025-01-08T15:15:00"
                    code: 400
                notFriends:
                  summary: 친구가 아님
                  value:
                    success: false
                    data: null
                    message: "친구 관계가 아닙니다."
                    errorCode: "NOT_FRIENDS"
                    timestamp: "2025-01-08T15:15:00"
                    code: 400
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: 사용자를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/chatrooms:
    get:
      tags:
        - Chat Room
      summary: 사용자의 채팅방 목록 조회
      description: |
        특정 사용자의 채팅방 전체 목록을 조회합니다.

        **조회 범위**:
        - 사용자가 참여 중인 모든 채팅방
        - 1:1 채팅 + 그룹 채팅 모두 포함

        **정렬**:
        - 최근 활동 순 (lastActiveAt 기준)
        - 고정된 채팅방은 상단에 표시 (isPinned)

        **워크플로우**:
        1. 사용자 확인
        2. 참여 중인 채팅방 조회
        3. 각 채팅방의 읽지 않은 메시지 수 계산
        4. 정렬 후 반환
      operationId: getChatRooms
      security:
        - BearerAuth: []
      parameters:
        - name: userId
          in: query
          required: true
          description: 조회할 사용자 ID
          schema:
            type: integer
            format: int64
          example: 1
      responses:
        '200':
          description: 채팅방 목록 조회 성공
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ResponseDto'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/ChatRoomResponse'
              examples:
                success:
                  summary: 성공 응답
                  value:
                    success: true
                    data:
                      - roomId: 50
                        title: "Jane Smith"
                        lastMessage: "안녕하세요!"
                        unreadMessages: 2
                        isPinned: true
                        timestamp: "오후 3:15"
                      - roomId: 101
                        title: "팀 프로젝트"
                        lastMessage: "내일 회의 어때요?"
                        unreadMessages: 5
                        isPinned: false
                        timestamp: "오전 11:20"
                      - roomId: 78
                        title: "Bob Jones"
                        lastMessage: "ㅋㅋㅋ"
                        unreadMessages: 0
                        isPinned: false
                        timestamp: "어제"
                    message: null
                    errorCode: null
                    timestamp: "2025-01-08T15:15:00"
                    code: 200
                emptyList:
                  summary: 채팅방 없음
                  value:
                    success: true
                    data: []
                    message: null
                    errorCode: null
                    timestamp: "2025-01-08T15:15:00"
                    code: 200
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: 사용자를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/chatrooms/{roomId}/exit:
    delete:
      tags:
        - Chat Room
      summary: 채팅방 퇴장
      description: |
        현재 사용자가 채팅방에서 퇴장합니다.

        **비즈니스 규칙**:
        - 1:1 채팅: 퇴장 불가 (숨김 처리만 가능)
        - 그룹 채팅: 퇴장 가능
        - 마지막 참여자가 퇴장하면 채팅방 자동 삭제
        - 퇴장 후 재입장 불가 (새로 초대받아야 함)

        **워크플로우**:
        1. 채팅방 및 참여자 확인
        2. 참여자 목록에서 제거
        3. PARTICIPANT_REMOVED 이벤트 발행
        4. 마지막 참여자였으면 채팅방 삭제
        5. 다른 참여자들에게 퇴장 알림

        **이벤트**:
        - `CHAT_ROOM_PARTICIPANT_CHANGED`: 참여자 변경 시 발행
      operationId: exitChatRoom
      security:
        - BearerAuth: []
      parameters:
        - name: roomId
          in: path
          required: true
          description: 퇴장할 채팅방 ID
          schema:
            type: integer
            format: int64
          example: 101
        - name: userId
          in: query
          required: true
          description: 퇴장하는 사용자 ID
          schema:
            type: integer
            format: int64
          example: 1
      responses:
        '200':
          description: 채팅방 퇴장 성공
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ResponseDto'
                  - type: object
                    properties:
                      data:
                        type: boolean
              examples:
                success:
                  summary: 성공 응답
                  value:
                    success: true
                    data: true
                    message: "채팅방에서 퇴장했습니다."
                    errorCode: null
                    timestamp: "2025-01-08T15:15:00"
                    code: 200
        '400':
          description: 잘못된 요청
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                individualChatExit:
                  summary: 1:1 채팅 퇴장 시도
                  value:
                    success: false
                    data: null
                    message: "1:1 채팅방은 퇴장할 수 없습니다."
                    errorCode: "INDIVIDUAL_CHAT_EXIT_NOT_ALLOWED"
                    timestamp: "2025-01-08T15:15:00"
                    code: 400
                notParticipant:
                  summary: 참여자가 아님
                  value:
                    success: false
                    data: null
                    message: "채팅방 참여자가 아닙니다."
                    errorCode: "NOT_PARTICIPANT"
                    timestamp: "2025-01-08T15:15:00"
                    code: 400
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: 채팅방을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/chatrooms/{roomId}/title:
    put:
      tags:
        - Chat Room
      summary: 채팅방 제목 변경
      description: |
        채팅방의 제목을 변경합니다.

        **비즈니스 규칙**:
        - 그룹 채팅만 제목 변경 가능
        - 1:1 채팅은 제목 변경 불가
        - 참여자만 제목 변경 가능
        - 빈 제목 불가

        **워크플로우**:
        1. 채팅방 타입 확인 (GROUP만 가능)
        2. 참여자 확인
        3. 제목 업데이트
        4. CHAT_ROOM_TITLE_CHANGED 이벤트 발행
        5. 모든 참여자에게 알림

        **이벤트**:
        - `CHAT_ROOM_TITLE_CHANGED`: 제목 변경 시 발행
      operationId: updateChatRoomTitle
      security:
        - BearerAuth: []
      parameters:
        - name: roomId
          in: path
          required: true
          description: 제목을 변경할 채팅방 ID
          schema:
            type: integer
            format: int64
          example: 101
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TitleRequest'
            examples:
              normal:
                summary: 일반적인 제목 변경
                value:
                  title: "새로운 팀 프로젝트"
      responses:
        '200':
          description: 제목 변경 성공
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ResponseDto'
                  - type: object
                    properties:
                      data:
                        type: boolean
              examples:
                success:
                  summary: 성공 응답
                  value:
                    success: true
                    data: true
                    message: "채팅방 제목이 변경되었습니다."
                    errorCode: null
                    timestamp: "2025-01-08T15:15:00"
                    code: 200
        '400':
          description: 잘못된 요청
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                individualChatTitle:
                  summary: 1:1 채팅 제목 변경 시도
                  value:
                    success: false
                    data: null
                    message: "1:1 채팅방은 제목을 변경할 수 없습니다."
                    errorCode: "INDIVIDUAL_CHAT_TITLE_NOT_ALLOWED"
                    timestamp: "2025-01-08T15:15:00"
                    code: 400
                emptyTitle:
                  summary: 빈 제목
                  value:
                    success: false
                    data: null
                    message: "제목은 비어있을 수 없습니다."
                    errorCode: "EMPTY_TITLE"
                    timestamp: "2025-01-08T15:15:00"
                    code: 400
                notParticipant:
                  summary: 참여자가 아님
                  value:
                    success: false
                    data: null
                    message: "채팅방 참여자가 아닙니다."
                    errorCode: "NOT_PARTICIPANT"
                    timestamp: "2025-01-08T15:15:00"
                    code: 400
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: 채팅방을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/chatrooms/search:
    get:
      tags:
        - Chat Room Search
      summary: 채팅방 검색
      description: |
        채팅방을 검색합니다.

        **검색 옵션**:
        - query: 채팅방 제목 검색 (부분 일치)
        - type: 채팅방 타입 필터 (INDIVIDUAL/GROUP)
        - unreadOnly: 읽지 않은 메시지가 있는 채팅방만

        **검색 범위**:
        - 사용자가 참여 중인 채팅방에서만 검색
        - 모든 필터는 AND 조건

        **워크플로우**:
        1. 사용자 확인
        2. 참여 중인 채팅방 조회
        3. 검색 조건 적용 (query, type, unreadOnly)
        4. 정렬 후 반환 (최근 활동순)
      operationId: searchChatRooms
      security:
        - BearerAuth: []
      parameters:
        - name: userId
          in: query
          required: true
          description: 검색하는 사용자 ID
          schema:
            type: integer
            format: int64
          example: 1
        - name: query
          in: query
          required: false
          description: 채팅방 제목 검색어 (부분 일치)
          schema:
            type: string
          example: "프로젝트"
        - name: type
          in: query
          required: false
          description: 채팅방 타입 (INDIVIDUAL/GROUP)
          schema:
            type: string
            enum: [INDIVIDUAL, GROUP]
          example: "GROUP"
        - name: unreadOnly
          in: query
          required: false
          description: 읽지 않은 메시지가 있는 채팅방만 (true/false)
          schema:
            type: boolean
            default: false
          example: true
      responses:
        '200':
          description: 검색 성공
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ResponseDto'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/ChatRoomResponse'
              examples:
                withResults:
                  summary: 검색 결과 있음
                  value:
                    success: true
                    data:
                      - roomId: 101
                        title: "팀 프로젝트"
                        lastMessage: "내일 회의 어때요?"
                        unreadMessages: 5
                        isPinned: false
                        timestamp: "오전 11:20"
                      - roomId: 205
                        title: "프로젝트 알파"
                        lastMessage: "확인했습니다"
                        unreadMessages: 0
                        isPinned: false
                        timestamp: "어제"
                    message: null
                    errorCode: null
                    timestamp: "2025-01-08T15:15:00"
                    code: 200
                emptyResults:
                  summary: 검색 결과 없음
                  value:
                    success: true
                    data: []
                    message: null
                    errorCode: null
                    timestamp: "2025-01-08T15:15:00"
                    code: 200
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: 사용자를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/chatrooms/direct:
    get:
      tags:
        - Chat Room Search
      summary: 두 사용자 간의 1:1 채팅방 찾기
      description: |
        두 사용자 ID를 받아 해당 사용자들 간의 1:1 채팅방을 찾습니다.

        **사용 사례**:
        - 채팅 시작 전 기존 채팅방 확인
        - 사용자 프로필에서 "메시지 보내기" 클릭 시

        **워크플로우**:
        1. 두 사용자 ID 확인
        2. type=INDIVIDUAL이며 두 사용자가 참여자인 채팅방 조회
        3. 있으면 채팅방 반환, 없으면 404

        **참고**:
        - 채팅방이 없으면 404 반환
        - 생성이 필요하면 POST /api/v1/chatrooms/create/direct 사용
      operationId: findDirectChatRoom
      security:
        - BearerAuth: []
      parameters:
        - name: myId
          in: query
          required: true
          description: 본인 사용자 ID
          schema:
            type: integer
            format: int64
          example: 1
        - name: otherUserId
          in: query
          required: true
          description: 상대방 사용자 ID
          schema:
            type: integer
            format: int64
          example: 2
      responses:
        '200':
          description: 채팅방 찾기 성공
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ResponseDto'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ChatRoomResponse'
              examples:
                found:
                  summary: 채팅방을 찾음
                  value:
                    success: true
                    data:
                      roomId: 50
                      title: "Jane Smith"
                      lastMessage: "안녕하세요!"
                      unreadMessages: 2
                      isPinned: true
                      timestamp: "오후 3:15"
                    message: "채팅방을 찾았습니다."
                    errorCode: null
                    timestamp: "2025-01-08T15:15:00"
                    code: 200
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: 채팅방을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                notFound:
                  summary: 채팅방 없음
                  value:
                    success: false
                    data: null
                    message: "채팅방을 찾을 수 없습니다."
                    errorCode: "CHATROOM_NOT_FOUND"
                    timestamp: "2025-01-08T15:15:00"
                    code: 404

  /api/v1/chatrooms/favorite:
    post:
      tags:
        - Chat Room Favorite
      summary: 채팅방 즐겨찾기/고정
      description: |
        사용자가 채팅방을 즐겨찾기(고정)로 등록하거나 해제합니다.

        **기능**:
        - 채팅방을 목록 상단에 고정
        - 토글 방식 (추가/제거)

        **비즈니스 규칙**:
        - 참여자만 즐겨찾기 가능
        - 사용자별로 독립적으로 관리
        - 최대 고정 개수 제한 없음

        **워크플로우**:
        1. 채팅방 및 참여자 확인
        2. isFavorite=true면 pinnedParticipants에 추가
        3. isFavorite=false면 pinnedParticipants에서 제거
        4. 업데이트된 채팅방 정보 반환
      operationId: updateFavoriteStatus
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChatRoomFavoriteRequest'
            examples:
              addFavorite:
                summary: 즐겨찾기 추가
                value:
                  roomId: 101
                  userId: 1
                  isFavorite: true
              removeFavorite:
                summary: 즐겨찾기 제거
                value:
                  roomId: 101
                  userId: 1
                  isFavorite: false
      responses:
        '200':
          description: 즐겨찾기 상태 변경 성공
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ResponseDto'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ChatRoomResponse'
              examples:
                added:
                  summary: 즐겨찾기 추가됨
                  value:
                    success: true
                    data:
                      roomId: 101
                      title: "팀 프로젝트"
                      lastMessage: "내일 회의 어때요?"
                      unreadMessages: 5
                      isPinned: true
                      timestamp: "오전 11:20"
                    message: "채팅방이 즐겨찾기에 추가되었습니다."
                    errorCode: null
                    timestamp: "2025-01-08T15:15:00"
                    code: 200
                removed:
                  summary: 즐겨찾기 제거됨
                  value:
                    success: true
                    data:
                      roomId: 101
                      title: "팀 프로젝트"
                      lastMessage: "내일 회의 어때요?"
                      unreadMessages: 5
                      isPinned: false
                      timestamp: "오전 11:20"
                    message: "채팅방이 즐겨찾기에서 제거되었습니다."
                    errorCode: null
                    timestamp: "2025-01-08T15:15:00"
                    code: 200
        '400':
          description: 잘못된 요청
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                notParticipant:
                  summary: 참여자가 아님
                  value:
                    success: false
                    data: null
                    message: "채팅방 참여자가 아닙니다."
                    errorCode: "NOT_PARTICIPANT"
                    timestamp: "2025-01-08T15:15:00"
                    code: 400
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: 채팅방을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/chatrooms/{roomId}/announcement:
    put:
      tags:
        - Chat Room Notice
      summary: 채팅방 공지사항 설정
      description: |
        채팅방의 공지사항을 업데이트합니다.

        **기능**:
        - 공지사항 설정/수정
        - 공지사항 삭제 (null 전달)

        **비즈니스 규칙**:
        - 그룹 채팅만 공지사항 설정 가능
        - 참여자만 공지 설정 가능 (권한 체크)
        - null 전달 시 공지사항 삭제

        **워크플로우**:
        1. 채팅방 타입 확인 (GROUP만 가능)
        2. 참여자 확인
        3. 공지사항 업데이트 (null이면 삭제)
        4. CHAT_ROOM_ANNOUNCEMENT_CHANGED 이벤트 발행
        5. 모든 참여자에게 알림

        **이벤트**:
        - `CHAT_ROOM_ANNOUNCEMENT_CHANGED`: 공지사항 변경 시 발행
      operationId: updateAnnouncement
      security:
        - BearerAuth: []
      parameters:
        - name: roomId
          in: path
          required: true
          description: 채팅방 ID
          schema:
            type: integer
            format: int64
          example: 101
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AnnouncementRequest'
            examples:
              setAnnouncement:
                summary: 공지사항 설정
                value:
                  announcement: "매주 월요일 오전 10시에 회의가 있습니다."
              clearAnnouncement:
                summary: 공지사항 삭제
                value:
                  announcement: null
      responses:
        '200':
          description: 공지사항 업데이트 성공
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ResponseDto'
                  - type: object
                    properties:
                      data:
                        type: object
                        nullable: true
              examples:
                success:
                  summary: 성공 응답
                  value:
                    success: true
                    data: null
                    message: "공지사항이 업데이트되었습니다."
                    errorCode: null
                    timestamp: "2025-01-08T15:15:00"
                    code: 200
        '400':
          description: 잘못된 요청
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                individualChat:
                  summary: 1:1 채팅에 공지사항 설정 시도
                  value:
                    success: false
                    data: null
                    message: "1:1 채팅방은 공지사항을 설정할 수 없습니다."
                    errorCode: "INDIVIDUAL_CHAT_ANNOUNCEMENT_NOT_ALLOWED"
                    timestamp: "2025-01-08T15:15:00"
                    code: 400
                notParticipant:
                  summary: 참여자가 아님
                  value:
                    success: false
                    data: null
                    message: "채팅방 참여자가 아닙니다."
                    errorCode: "NOT_PARTICIPANT"
                    timestamp: "2025-01-08T15:15:00"
                    code: 400
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: 채팅방을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/chatrooms/list:
    get:
      tags:
        - Chat Room List
      summary: 채팅방 목록 조회
      description: |
        사용자가 참여 중인 채팅방 목록을 반환합니다.

        **기능**:
        - GET /api/v1/chatrooms와 동일한 기능
        - 별도의 엔드포인트로 제공 (클라이언트 편의성)

        **조회 범위**:
        - 사용자가 참여 중인 모든 채팅방
        - 1:1 채팅 + 그룹 채팅 모두 포함

        **정렬**:
        - 최근 활동 순 (lastActiveAt 기준)
        - 고정된 채팅방은 상단에 표시 (isPinned)

        **워크플로우**:
        1. 사용자 확인
        2. 참여 중인 채팅방 조회
        3. 각 채팅방의 읽지 않은 메시지 수 계산
        4. 정렬 후 반환

        **참고**:
        - GET /api/v1/chatrooms와 동일한 결과 반환
      operationId: getChatRoomsList
      security:
        - BearerAuth: []
      parameters:
        - name: userId
          in: query
          required: true
          description: 조회할 사용자 ID
          schema:
            type: integer
            format: int64
          example: 1
      responses:
        '200':
          description: 채팅방 목록 조회 성공
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ResponseDto'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/ChatRoomResponse'
              examples:
                success:
                  summary: 성공 응답
                  value:
                    success: true
                    data:
                      - roomId: 50
                        title: "Jane Smith"
                        lastMessage: "안녕하세요!"
                        unreadMessages: 2
                        isPinned: true
                        timestamp: "오후 3:15"
                      - roomId: 101
                        title: "팀 프로젝트"
                        lastMessage: "내일 회의 어때요?"
                        unreadMessages: 5
                        isPinned: false
                        timestamp: "오전 11:20"
                    message: null
                    errorCode: null
                    timestamp: "2025-01-08T15:15:00"
                    code: 200
                emptyList:
                  summary: 채팅방 없음
                  value:
                    success: true
                    data: []
                    message: null
                    errorCode: null
                    timestamp: "2025-01-08T15:15:00"
                    code: 200
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: 사용자를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/chatrooms/{roomId}/participants:
    post:
      tags:
        - Multiple Chat Room
      summary: 채팅방 참여자 추가
      description: |
        채팅방에 참여자를 추가합니다.

        **비즈니스 규칙**:
        - 그룹 채팅만 참여자 추가 가능
        - 1:1 채팅은 참여자 추가 불가
        - 최대 참여자 수: 100명
        - 이미 참여 중인 사용자는 추가 불가
        - 참여자만 다른 사용자를 추가 가능

        **워크플로우**:
        1. 채팅방 타입 확인 (GROUP만 가능)
        2. 최대 참여자 수 확인
        3. 이미 참여 중인지 확인
        4. 참여자 목록에 추가
        5. CHAT_ROOM_PARTICIPANT_CHANGED 이벤트 발행
        6. 모든 참여자에게 알림

        **이벤트**:
        - `CHAT_ROOM_PARTICIPANT_CHANGED`: 참여자 변경 시 발행
      operationId: addParticipant
      security:
        - BearerAuth: []
      parameters:
        - name: roomId
          in: path
          required: true
          description: 채팅방 ID
          schema:
            type: integer
            format: int64
          example: 101
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ManageParticipantRequest'
            examples:
              normal:
                summary: 참여자 추가
                value:
                  userId: 5
      responses:
        '200':
          description: 참여자 추가 성공
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ResponseDto'
                  - type: object
                    properties:
                      data:
                        type: boolean
              examples:
                success:
                  summary: 성공 응답
                  value:
                    success: true
                    data: true
                    message: "참여자가 추가되었습니다."
                    errorCode: null
                    timestamp: "2025-01-08T15:15:00"
                    code: 200
        '400':
          description: 잘못된 요청
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                individualChat:
                  summary: 1:1 채팅에 참여자 추가 시도
                  value:
                    success: false
                    data: null
                    message: "1:1 채팅방은 참여자를 추가할 수 없습니다."
                    errorCode: "INDIVIDUAL_CHAT_PARTICIPANT_ADD_NOT_ALLOWED"
                    timestamp: "2025-01-08T15:15:00"
                    code: 400
                maxParticipants:
                  summary: 최대 참여자 수 초과
                  value:
                    success: false
                    data: null
                    message: "최대 참여자 수(100명)를 초과했습니다."
                    errorCode: "MAX_PARTICIPANTS_EXCEEDED"
                    timestamp: "2025-01-08T15:15:00"
                    code: 400
                alreadyParticipant:
                  summary: 이미 참여 중
                  value:
                    success: false
                    data: null
                    message: "이미 채팅방에 참여 중입니다."
                    errorCode: "ALREADY_PARTICIPANT"
                    timestamp: "2025-01-08T15:15:00"
                    code: 400
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: 권한 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                notParticipant:
                  summary: 참여자가 아님
                  value:
                    success: false
                    data: null
                    message: "채팅방 참여자만 다른 사용자를 추가할 수 있습니다."
                    errorCode: "NOT_PARTICIPANT"
                    timestamp: "2025-01-08T15:15:00"
                    code: 403
        '404':
          description: 채팅방을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - Multiple Chat Room
      summary: 채팅방 참여자 제거
      description: |
        채팅방에서 참여자를 제거합니다.

        **비즈니스 규칙**:
        - 그룹 채팅만 참여자 제거 가능
        - 1:1 채팅은 참여자 제거 불가
        - 참여자만 다른 사용자를 제거 가능
        - 마지막 참여자를 제거하면 채팅방 자동 삭제

        **워크플로우**:
        1. 채팅방 타입 확인 (GROUP만 가능)
        2. 참여자 확인
        3. 참여자 목록에서 제거
        4. CHAT_ROOM_PARTICIPANT_CHANGED 이벤트 발행
        5. 마지막 참여자였으면 채팅방 삭제
        6. 모든 참여자에게 알림

        **이벤트**:
        - `CHAT_ROOM_PARTICIPANT_CHANGED`: 참여자 변경 시 발행
      operationId: removeParticipant
      security:
        - BearerAuth: []
      parameters:
        - name: roomId
          in: path
          required: true
          description: 채팅방 ID
          schema:
            type: integer
            format: int64
          example: 101
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ManageParticipantRequest'
            examples:
              normal:
                summary: 참여자 제거
                value:
                  userId: 5
      responses:
        '200':
          description: 참여자 제거 성공
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ResponseDto'
                  - type: object
                    properties:
                      data:
                        type: boolean
              examples:
                success:
                  summary: 성공 응답
                  value:
                    success: true
                    data: true
                    message: "참여자가 제거되었습니다."
                    errorCode: null
                    timestamp: "2025-01-08T15:15:00"
                    code: 200
        '400':
          description: 잘못된 요청
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                individualChat:
                  summary: 1:1 채팅에서 참여자 제거 시도
                  value:
                    success: false
                    data: null
                    message: "1:1 채팅방은 참여자를 제거할 수 없습니다."
                    errorCode: "INDIVIDUAL_CHAT_PARTICIPANT_REMOVE_NOT_ALLOWED"
                    timestamp: "2025-01-08T15:15:00"
                    code: 400
                notInRoom:
                  summary: 참여 중이 아님
                  value:
                    success: false
                    data: null
                    message: "채팅방에 참여하지 않은 사용자입니다."
                    errorCode: "NOT_IN_ROOM"
                    timestamp: "2025-01-08T15:15:00"
                    code: 400
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: 권한 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: 채팅방을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/chatrooms/{roomId}/invite:
    post:
      tags:
        - Multiple Chat Room
      summary: 채팅방 초대
      description: |
        채팅방에 사용자를 초대합니다.

        **기능**:
        - POST /api/v1/chatrooms/{roomId}/participants와 동일한 기능
        - 의미적으로 더 명확한 엔드포인트 (초대)

        **비즈니스 규칙**:
        - 그룹 채팅만 초대 가능
        - 최대 참여자 수: 100명
        - 이미 참여 중인 사용자는 초대 불가

        **워크플로우**:
        1. 채팅방 타입 확인 (GROUP만 가능)
        2. 최대 참여자 수 확인
        3. 이미 참여 중인지 확인
        4. 참여자 목록에 추가
        5. CHAT_ROOM_PARTICIPANT_CHANGED 이벤트 발행
        6. 초대된 사용자에게 알림 전송

        **이벤트**:
        - `CHAT_ROOM_PARTICIPANT_CHANGED`: 참여자 변경 시 발행
      operationId: inviteParticipant
      security:
        - BearerAuth: []
      parameters:
        - name: roomId
          in: path
          required: true
          description: 채팅방 ID
          schema:
            type: integer
            format: int64
          example: 101
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InvitationRequest'
            examples:
              normal:
                summary: 사용자 초대
                value:
                  userId: 5
      responses:
        '200':
          description: 초대 성공
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ResponseDto'
                  - type: object
                    properties:
                      data:
                        type: boolean
              examples:
                success:
                  summary: 성공 응답
                  value:
                    success: true
                    data: true
                    message: "사용자를 채팅방에 초대했습니다."
                    errorCode: null
                    timestamp: "2025-01-08T15:15:00"
                    code: 200
        '400':
          description: 잘못된 요청
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                individualChat:
                  summary: 1:1 채팅에 초대 시도
                  value:
                    success: false
                    data: null
                    message: "1:1 채팅방은 사용자를 초대할 수 없습니다."
                    errorCode: "INDIVIDUAL_CHAT_INVITE_NOT_ALLOWED"
                    timestamp: "2025-01-08T15:15:00"
                    code: 400
                maxParticipants:
                  summary: 최대 참여자 수 초과
                  value:
                    success: false
                    data: null
                    message: "최대 참여자 수(100명)를 초과했습니다."
                    errorCode: "MAX_PARTICIPANTS_EXCEEDED"
                    timestamp: "2025-01-08T15:15:00"
                    code: 400
                alreadyParticipant:
                  summary: 이미 참여 중
                  value:
                    success: false
                    data: null
                    message: "이미 채팅방에 참여 중입니다."
                    errorCode: "ALREADY_PARTICIPANT"
                    timestamp: "2025-01-08T15:15:00"
                    code: 400
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: 권한 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: 채팅방을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT 기반 인증

        **사용 방법**:
        ```
        Authorization: Bearer <access_token>
        ```

        **토큰 획득**:
        - POST /api/v1/auth/login으로 로그인하여 토큰 획득

        **토큰 갱신**:
        - POST /api/v1/auth/refresh-token으로 refresh token을 사용하여 새 access token 획득

  schemas:
    # Common Response Schemas
    ResponseDto:
      type: object
      required:
        - success
        - timestamp
        - code
      properties:
        success:
          type: boolean
          description: 요청 성공 여부
          example: true
        data:
          type: object
          nullable: true
          description: 응답 데이터 (타입은 각 API마다 다름)
        message:
          type: string
          nullable: true
          description: 응답 메시지
          example: "요청이 성공적으로 처리되었습니다."
        errorCode:
          type: string
          nullable: true
          description: 에러 코드 (에러 발생 시에만)
          example: null
        timestamp:
          type: string
          format: date-time
          description: 응답 시각 (ISO 8601)
          example: "2025-01-08T15:15:00"
        code:
          type: integer
          description: HTTP 상태 코드
          example: 200

    ErrorResponse:
      allOf:
        - $ref: '#/components/schemas/ResponseDto'
        - type: object
          properties:
            success:
              type: boolean
              example: false
            data:
              type: object
              nullable: true
              example: null
            errorCode:
              type: string
              description: 에러 코드
              example: "VALIDATION_ERROR"

    # Chat Room Schemas
    CreateDirectChatRequest:
      type: object
      description: 1:1 채팅방 생성 요청
      required:
        - userId
        - friendId
      properties:
        userId:
          type: integer
          format: int64
          description: 채팅을 생성하는 사용자 ID
          example: 1
        friendId:
          type: integer
          format: int64
          description: 채팅 상대방 친구 ID
          example: 2

    TitleRequest:
      type: object
      description: 채팅방 제목 변경 요청
      required:
        - title
      properties:
        title:
          type: string
          description: 새로운 채팅방 제목
          minLength: 1
          example: "새로운 팀 프로젝트"

    ChatRoomResponse:
      type: object
      description: 채팅방 정보
      required:
        - roomId
        - title
        - unreadMessages
        - isPinned
        - timestamp
      properties:
        roomId:
          type: integer
          format: int64
          description: 채팅방 ID
          example: 101
        title:
          type: string
          description: 채팅방 제목 (1:1 채팅인 경우 상대방 이름)
          example: "Jane Smith"
        lastMessage:
          type: string
          nullable: true
          description: 마지막 메시지 내용
          example: "안녕하세요!"
        unreadMessages:
          type: integer
          description: 읽지 않은 메시지 수
          example: 2
        isPinned:
          type: boolean
          description: 채팅방 고정 여부
          example: true
        timestamp:
          type: string
          description: 마지막 활동 시간 (포맷팅된 형태)
          example: "오후 3:15"

    ChatRoomFavoriteRequest:
      type: object
      description: 채팅방 즐겨찾기 상태 변경 요청
      required:
        - roomId
        - userId
        - isFavorite
      properties:
        roomId:
          type: integer
          format: int64
          description: 채팅방 ID
          example: 101
        userId:
          type: integer
          format: int64
          description: 사용자 ID
          example: 1
        isFavorite:
          type: boolean
          description: 즐겨찾기 여부 (true=추가, false=제거)
          example: true

    AnnouncementRequest:
      type: object
      description: 채팅방 공지사항 설정 요청
      properties:
        announcement:
          type: string
          nullable: true
          description: 공지사항 내용 (null이면 삭제)
          example: "매주 월요일 오전 10시에 회의가 있습니다."

    ManageParticipantRequest:
      type: object
      description: 채팅방 참여자 관리 요청
      required:
        - userId
      properties:
        userId:
          type: integer
          format: int64
          description: 추가/제거할 사용자 ID
          example: 5

    InvitationRequest:
      type: object
      description: 채팅방 초대 요청
      required:
        - userId
      properties:
        userId:
          type: integer
          format: int64
          description: 초대할 사용자 ID
          example: 5

  responses:
    Unauthorized:
      description: 인증 실패 - 유효하지 않거나 만료된 토큰
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            invalidToken:
              summary: 유효하지 않은 토큰
              value:
                success: false
                data: null
                message: "유효하지 않은 토큰입니다."
                errorCode: "INVALID_TOKEN"
                timestamp: "2025-01-08T15:15:00"
                code: 401
            expiredToken:
              summary: 만료된 토큰
              value:
                success: false
                data: null
                message: "토큰이 만료되었습니다."
                errorCode: "EXPIRED_TOKEN"
                timestamp: "2025-01-08T15:15:00"
                code: 401
